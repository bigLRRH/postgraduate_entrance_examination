# 计算机组成原理

## 1 计算机系统概述

### 1.1 计算机系统层次结构

#### 1.1.1 计算机系统的基本组成

**计算机系统**由**硬件**与**软件**两大部分组成。
**硬件**是指计算机的实体部分。
**软件**包括在硬件上的**程序**、**数据**以及**相关的文档**。
**程序**是指挥计算机如何操作的一个指令序列。
**数据**是指令操作的对象。

#### 1.1.2 计算机硬件的基本结构

冯·诺伊曼提出了“存储程序”的概念。
“存储程序”：将程序和数据一起存放在存储器中。
冯·诺伊曼机的基本思想：
（1） 计算机由**运算器**、**存储器**、**控制器**、**输入设备**和**输出设备**五大部件组成。
（2） 指令和数据以**同等地位**存储在存储器中，并可按地址寻访。
（3） 指令和数据均用**二进制数**表示。
（4） 指令**由操作码和地址码组成**，操作码用来表示操作的性质，地址码用来表示操作数在存储器中的位置。
（5）指令在存储器内**按顺序存放**。通常，指令是按顺序执行的，在特定条件下，可根据运算结果或根据设定的条件改变执行顺序。 \*（6）机器以运算器为中心，输入输出设备与存储器间的数据传送通过运算器完成。

典型的冯·诺伊曼计算机是以运算器为中心的，现代的计算机已转化为以存储器为中心。

五大部件的功能：
运算器用来完成算术运算和逻辑运算,并将运算的中间结果暂存在运算器内。
存储器用来存放数据和程序。
控制器用来控制、指挥程序和数据的输入、运行以及处理运算结果。
输入设备用来将人们熟悉的信息形式转换为机器能识别的信息形式。
输出设备可将机器运算结果转换为人们熟悉的信息形式或其他系统所要求的信息形式。
计算机的五大部件（又称五大子系统）在控制器的统一指挥下，有条不紊的自动工作。

现代计算机的组成：
**（1）中央处理器**
中央处理器（简称 CPU 或处理器）是整个计算机的核心部件，主要用于指令的执行。
CPU 主要包含两种基本部件：**数据通路**和**控制器**。
**数据通路**主要包含**算术逻辑单元**和**通用寄存器**等。
算数逻辑单元（Arithmetic and Logic Unit, **ALU**，简称**算逻部件**）用来执行算数运算和逻辑运算。
通用寄存器用来暂存指令所用的操作数或执行结果。
**控制单元**（Control Unit，**CU**）用来解释存储器中的指令，并发出各种操作命令来执行命令。
**（2）存储器**
存储器分为**内存**和**外存**。
内存包括**主存储器**（main memory，简称**主存**或**内存储器**）和**高速缓存**（cache）。
CPU 能直接访问的存储器是主存储器。
外存（也称**辅存**、**辅助存储器**或**外存储器**）用于帮助主存储器记忆更多的信息，辅助存储器中的信息必须调入主存储器。
**（3）外部设备和设备控制器**
外部设备简称外设，也称为 I/O 设备，其中，I/O 是输入/输出（input/output）的缩写。
外设通常由**机械部分**和**电子部分**组成，这两部分通常是可以分开的，机械部分是外部设备本身，电子部分是控制外部设备的设备控制器。
外设通过设备控制器连接到主机上，各种设备控制器统称为 I/O 控制器，I/O 接口或 I/O 模块。
**（4）总线**
总线（bus）是传输信息的介质。

#### 1.1.3 计算机软件和硬件的关系

#### 1.1.4 计算机系统的工作原理

##### 1.1.4.1 “存储程序”工作方式

##### 1.1.4.2 高级语言程序与机器语言程序之间的转换

(1) 通过程序编辑软件得到 hello.c 文件（源程序）。hello.c 在计算机中以 ASCII 字符方式存放。
(2) 将 hello.c 进行预处理、编译、汇编和链接，最终生成可执行目标文件。

**预处理：** 预处理器（cpp）队源程序中以字符#开头的命令进行处理。例如将#include 命令后面的.h 文件插入程序文件。输出结果还是一个源程序文件，以 **.i** 为扩展名。
**编译：** 编译器（ccl）队预处理后的源程序进行编译,生成一个汇编语言源程序文件，以 **.s** 为扩展名。
**汇编：** 汇编程序（as）队汇编语言源程序进行汇编，生成一个可重定位目标文件（relocatable object file），以 **.o** 为扩展名；它是一种二进制文件。
**链接：** 链接程序（ld）将多个可重定位目标文件和标准库函数合并成一个可执行目标文件（executable object file，简称可执行文件），**无扩展名**。

##### 1.1.4.3 程序和指令的执行过程

### 1.2 计算机性能指标

#### 1.2.1 吞吐量、响应时间

吞吐量（throughput）和响应时间（response time）是考量一个计算机系统性能的两个基本指标。
**吞吐量**表示单位时间内所完成的工作量。
**响应时间**也称为执行时间（execution time）或等待时间（latency），从作业提交到开始到作业完成所用的时间。

#### 1.2.2 CPU 时钟周期、主频、CPI、CPU 执行时间

**CPU 时钟周期（clock cycle，tick,clock tick，clock）**
CPU 主脉冲信号的宽度，CPU 工作的最小时间单位。

**主频（clock rate，CPU 时钟频率）**
主脉冲信号的时钟频率，CPU 时钟周期的倒数，衡量机器速度的重要参数。
以赫兹（Hz）为单位。

**CPI（cycles per instruction）**
执行一条指令所需的时钟周期数。
不同指令的功能不同，所需的时间周期数也可能不同。
一条特点指令的 CPI 指执行该条指令所需的时钟周期数。
对于一个程序或一台机器来说，其 CPI 指该程序或该机器指令集中的所有指令执行所需的平均时钟周期数。

**CPU 执行时间**
运行一个程序所花费的时间。
计算机的性能可以看成 CPU 执行时间的倒数。
两台计算机性能之比可以看出 CPU 执行时间之比的倒数。

**公式：**

$$
\begin{aligned}
    \text{CPU执行时间} & = \frac{\text{程序总时钟周期数}}{\text{时钟频率}} \\
                   & = \text{程序总时钟周期数} \times \text{时钟周期}
\end{aligned}
$$

$$
\text{程序总时钟周期数} = \text{程序总指令条数} \times CPI
$$

$$
\text{程序总时钟周期数} = \sum_{i=1}^{n}(CPI_i \times C_i)
$$

其中，第 $i$ 种指令的条数和 CPI 分别为 $C_i$ 和 $CPI_i$ 。

$$
CPI = \sum_{i=1}^{n}(CPI_i \times F_i) = \text{程序总时钟周期数} \div \text{程序总指令条数}
$$

其中, $F_i$ 表示第 $i$ 种指令在程序中所占的比例。

CPU 执行时间度量公式中的时钟周期、指令条数、CPI 三个因素相互制约。同一台计算机，指令条数最少的程序也不一定执行得最快。

$$
\begin{array}{|l|l|l|}
    \hline
    \text{名称}          & \text{单位}                                \\
    \hline
    \text{主频}(f)       & \text{赫兹(Hz)}                            \\
    \text{CPI}(CPI)    & \text{周期数每指令(cpi，cycle per instruction)} \\
    \text{指令条数}(I)     & \text{条}                                 \\
    \text{周期}(T)       & \text{秒(s)}                              \\
    \text{周期数}(C)      & \text{个（c,cycles）或（t，times）}             \\
    \text{CPU 执行时间}(t) & \text{秒(s)}                              \\
    \hline
\end{array}
$$

**_注：单位和缩写仅辅助记忆_**

#### 1.2.3 MIPS、MFLOPS、GFLOPS、TFLOPS、PFLOPS、EFLOPS、ZFLOPS

$$
\begin{array}{|l|l|l|l|l|l|l|l|l|l|l|l|l|}
    \hline
    \text{前缀} & Z       & E       & P       & T       & G      & M      & K      & 1    & m       & \mu     & n       & p        \\
    \hline
    10^n      & 10^{21} & 10^{18} & 10^{15} & 10^{12} & 10^9   & 10^6   & 10^3   & 10^0 & 10^{-3} & 10^{-6} & 10^{-9} & 10^{-12} \\
    \hline
    2^n       & 2^{70}  & 2^{60}  & 2^{50}  & 2^{40}  & 2^{30} & 2^{20} & 2^{10} & 2^0  & 2^{-10} & 2^{-20} & 2^{-30} & 2^{-40}  \\
    \hline
\end{array}
$$

## 2 数据的表示和运算

### 2.1 数制与编码

#### 2.1.1 进位计数制及其数据之间的相互转换

##### 杂项

数字化编码：
作用：将现实世界的感觉媒体信息（如声音、文字、图画、活动图像等）转化为二进制编码表示。
方法：将连续信息转换为离散的“样本”信息，然后对它们用“0”和“1”进行编码。

采用二进制表示的原因：
（1）二进制**只有两种基本状态**，容易用物理器件实现。
（2）二进制的**编码和运算规则简单**，可用开关电路实现，简便易行。
（3）两个符号 0 和 1 正好**与逻辑命题的“真”和“假”相对应**，容易通过逻辑门实现逻辑运算和程序的逻辑判断，特别是**能通过逻辑门电路方便地实现算数运算**。

指令所处理的基本数据类型：
**数值型数据**：表示数量的多少，可比较其大小，分为整数和实数，整数又分为无符号整数和带符号整数。
**非数值型数据**：不表示数量的多少，没有大小之分。

表示一个**数值数据**的三要素：**进位计数制**、**定/浮点表示**和**编码规则**。

##### 一、进位计数制

基数：数制所使用的不同数码的个数。（二进制的基数为 2（0，1），十进制的基数为 10（0~9））
位权：数码在不同位置上的权值。
一个进位数的数值大小就是它的各位数码按权相加。

一般地，任意一个 r 进制数：

$$
R=k_nk_{n-1}\cdots k_1k_0k_{-1}k_{-2}\cdots k_{-m} \text{（ $m,n$ 为正整数 ）}
$$

其值为

$$
\begin{aligned}
    value(R) & =k_nr^n+k_{n-1}r^{n-1}+\cdots+k_1r^1+k_0r^0+k_{-1}r^{-1}+k_{-2}r^{-2}+\cdots+k_{-m}r^{-m} \\
             & =\sum_{i=n}^{m}k_ir^i
\end{aligned}
$$

式中，$r$ 是基数；$r^i$ 是第 $i$ 位的位权；$k_i$ 的取值是 $0,1,\cdots r-1$ 共 $r$ 个数码中的任意一个。

四种进制数之间的关系：

$$
\begin{array}{|c|c|c|c|c|}
        \hline
        \text{进位计数制} & \text{二进制}  & \text{八进制}           & \text{十进制}       & \text{十六进制}           \\
        \hline
        \text{规则}    & \text{逢二进一} & \text{逢八进一}          & \text{逢十进一}      & \text{逢十六进一}          \\
        \hline
        \text{数码}    & 01          & 01234567             & 0123456789       & 0123456789ABCDEF      \\
        \hline
        \text{基数}    & 2           & 8                    & 10               & 16                    \\
        \hline
        \text{位权}    & 2^i         & 8^i                  & 10^i             & 16^i                  \\
        \hline
        \text{标识符}   & \text{后缀B}  & \text{后缀O}           & \text{后缀D（通常省略）} & \text{后缀H或前缀0x}       \\
        \hline
        \text{备注}    & \text{}     & \text{3位二进制可转为1位八进制} & \text{}          & \text{4位二进制可转为1位十六进制} \\
        \hline
    \end{array}
$$

##### 二、不同进制数之间的转换

R 进制数转换成十进制数：**“按权展开”**。
十进制数转换为 R 进制数：**整数部分“除 R 取余，倒序排列”，小数部分“乘 R 取整，正序排列”。**
原理：R 进制数的数值表示公式。

二进制与八进制和十六进制转换：3 位二进制可转为 1 位八进制，4 位二进制可转为 1 位十六进制。

**_注意：_ 不是每个十进制小数都可以被二进制小数表示。**

#### 2.1.2 定点数的编码表示

##### 一、真值和机器数

**真值：带“+”或“-”符号的数。**
例：+123，-123。
真值是机器数所代表的实际值。

**机器数：把符号“数字化”的数**。
例：原码、补码、反码、移码。
通常用“0”表示正，用 1 表示负。

##### 二、机器数的定点表示

定点表示：小数点位置约定为固定位置。  
浮点表示：小数点位置约定为可浮动。

在现代计算机中，**通常用补码整数表示整数，用原码小数表示浮点数的尾数部分，用移码表示浮点数的阶码部分**。

##### 三、原码、补码、反码、移码

###### （1） 原码

整数原码的定义：

$$
[x]_{\text{原}} =
\begin{cases}
    0, x                & x \in [0, 2^n)  \\
    2^n - x = 2^n + |x| & x \in (-2^n, 0]
\end{cases}
$$

式中，$x$ 为真值，$n$ 为整数的位数。

小数原码的定义：

$$
[x]_{\text{原}} =
\begin{cases}
    x   & x \in [0, 1)  \\
    1-x & x \in (-1, 0]
\end{cases}
$$

式中，$x$ 为真值。

###### （2） 补码

定义：

$$
[x]_{\text{补}} =
\begin{cases}
    0, x          & x \in [0, 2^n)  \\
    2^{n+1} - |x| & x \in [-2^n, 0)
\end{cases}
$$

###### （3） 反码

定义：

$$
[x]_{\text{反}} =
\begin{cases}
    0, x              & x \in [0, 2^n)                              \\
    (2^{n+1} - 1) + x & x \in (-2^n, 0] \ (\text{mod}(2^{n+1} - 1))
\end{cases}
$$

###### （4） 移码

定义：

$$
[x]_{\text{移}} = 2^n + x \ (x \in [-2^n, 2^n)) \ \text{（其中机器字长为n+1）}
$$

##### 补充

$$
    \begin{array}{|l|l|l|l|l|}
        \hline
        \text{编码（表示法）}                                                & \text{原码} & \text{补码} & \text{反码} & \text{移码}
        \\
        \hline
        \text{计算方法}                                                   &           &           &           &           \\
        \\
        \hline
        \begin{array}{l}
            特殊值 \\
            \text{(补码和移码为通常情况)}
        \end{array}                                           &
        \begin{array}{lll}
            [x]_{\text{原}max} & = 0,111 \ 1111 & = +127 \\
            [+0]_\text{原}     & = 0,000 \ 0000 & =+0    \\
            [-0]_\text{原}     & = 1,000 \ 0000 & =-0    \\
            [x]_{\text{原}min} & = 1,111 \ 1111 & = -127
        \end{array}   &
        \begin{array}{lll}
            [x]_{\text{补}max}   & = 0,111 \ 1111 & = +127 \\
            [0]_\text{补}        & = 0,000 \ 0000 & =0     \\
            [x]_{\text{补}min}+1 & = 1,000 \ 0001 & = -127 \\
            [x]_{\text{补}min}   & = 1,000 \ 0000 & = -128
        \end{array} &
        \begin{array}{lll}
            [x]_{\text{反}max} & = 0,111 \ 1111 & = +127 \\
            [+0]_\text{反}     & = 0,000 \ 0000 & =+0    \\
            [-0]_\text{反}     & = 1,111 \ 1111 & =-0    \\
            [x]_{\text{反}min} & = 1,000 \ 0000 & = -127 \\
        \end{array}  &
        \begin{array}{lll}
            [x]_{\text{移}max} & = 1,111 \ 1111 & = +127 \\
            [0]_\text{移}      & = 1,000 \ 0000 & =0
            \\          [x]_{\text{移}min}+1 &= 0,000 \ 0001 &=-127
            \\
            [x]_{\text{移}min} & = 0,000 \ 0000 & = -128
        \end{array}
        \\
        \hline
        \text{优点}                                                     &
        \begin{array}{l}
            \text{与真值的对应关系直观} \\
            \text{实现乘除运算简便}
        \end{array}                                          &
        \begin{array}{l}
            \text{0的表示唯一}      \\
            \text{表示范围多一个最小负数} \\
            \text{符号位可参与运算}
        \end{array}                                         &
        \begin{array}{l}
            \text{通常用作数码变换的中间表示}
        \end{array}
                                                                      &
        \begin{array}{l}
            \text{0的表示唯一}      \\
            \text{表示范围多一个最小负数} \\
            \text{保持了数据原有的大小顺序}
        \end{array}
        \\
        \hline
        \text{缺点}                                                     &
        \begin{array}{l}
            \text{0的表示不唯一}     \\
            \text{表示范围少一个最小负数} \\
            \text{符号和数值部分须分开处理}
        \end{array}                                         &
                                                                      &
        \begin{array}{l}
            \text{0的表示不唯一}     \\
            \text{表示范围少一个最小负数} \\
            \text{符号和数值部分须分开处理}
        \end{array}                                         &

        \\
        \hline
    \end{array}
$$

### 2.2 运算方法和运算电路

#### 2.2.1 基本运算部件

#### 2.2.2 加/减运算

#### 2.2.3 乘/除运算

### 2.3 整数的表示和运算

#### 2.3.1 无符号整数的表示和运算

#### 2.3.2 带符号整数的表示和运算

### 2.4 浮点数的表示和运算

#### 2.4.1 浮点数的表示（IEEE 754 标准）

#### 2.4.2 浮点数的加/减运算

## 3 存储器层次结构

### 3.1 存储器的分类

### 3.2 层次化存储器的基本结构

### 3.3 半导体随机存取存储器

#### 3.3.1 SRAM 存储器

#### 3.3.2 DRAM 存储器

#### 3.3.3 Flash 存储器

### 3.4 主存储器

#### 3.4.1 DRAM 芯片和内存条

#### 3.4.2 多模块存储器

#### 3.4.3 主存和 CPU 之间的连接

### 3.5 外部存储器

### 3.6 高速缓冲存储器（Cache）

### 3.7 虚拟存储器

## 4 指令系统

## 5 中央处理器（CPU）

## 6 总线和输入/输出系统
